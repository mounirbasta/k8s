# ArgoCD Applications

This folder contains ArgoCD Application manifests for GitOps deployment.

## Files

- `app-dev-application.yaml` - Dev environment application
- `app-staging-application.yaml` - Staging environment application  
- `app-production-application.yaml` - Production environment application

## Setup

### 1. Install ArgoCD

```bash
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```

### 2. Access ArgoCD UI

```bash
# Port forward
kubectl port-forward svc/argocd-server -n argocd 8080:443

# Get password
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo

# Login at: https://localhost:8080
# Username: admin
# Password: (from above)
```

### 3. Update Repository URL

Edit each application file and change:

```yaml
spec:
  source:
    repoURL: https://github.com/YOUR-USERNAME/YOUR-REPO.git  # ← Update this
```

### 4. Deploy Applications

```bash
# Deploy dev environment
kubectl apply -f app-dev-application.yaml

# Deploy staging (optional)
kubectl apply -f app-staging-application.yaml

# Deploy production (optional)
kubectl apply -f app-production-application.yaml
```

### 5. Verify

```bash
# Check applications
kubectl get applications -n argocd

# Or via ArgoCD UI
# Go to https://localhost:8080
```

## How GitOps Works

```
1. You push changes to Git
   ↓
2. ArgoCD detects changes (every 3 minutes)
   ↓
3. ArgoCD syncs cluster with Git state
   ↓
4. Your app is updated automatically
```

## Making Changes

```bash
# 1. Edit manifests
vi deployments/app-dev.yaml

# 2. Commit and push
git add deployments/app-dev.yaml
git commit -m "Update deployment"
git push origin main

# 3. ArgoCD auto-syncs (if enabled)
# Or manually: argocd app sync my-app-dev
```

## Configuration

### Auto-sync (Dev)
Dev has automatic sync enabled:
- `prune: true` - Deletes resources removed from Git
- `selfHeal: true` - Fixes any manual changes back to Git state

### Manual Sync (Production)
Production requires manual approval:
- No `automated` section
- Sync via UI or CLI: `argocd app sync my-app-production`

## Troubleshooting

### Application Not Syncing

```bash
# Check application status
kubectl get application my-app-dev -n argocd

# View details
argocd app get my-app-dev

# Manual sync
argocd app sync my-app-dev
```

### Sync Failed

```bash
# Check application events
kubectl describe application my-app-dev -n argocd

# Check ArgoCD logs
kubectl logs -n argocd deployment/argocd-application-controller
```

## Documentation

See [ARGOCD_GUIDE.md](../ARGOCD_GUIDE.md) for complete setup instructions.
